

ä»¥ä¸‹æ˜¯åŸºäº `TODO.md` ä¸ºä½ å®šåˆ¶çš„ **åˆ†é˜¶æ®µ Vibe Coding æç¤ºè¯ (Prompt Pack)**ã€‚

ä½ å¯ä»¥ç›´æ¥å¤åˆ¶å¯¹åº”çš„ Block å‘é€ç»™ Cursor/VSCode çš„ AI åŠ©æ‰‹ã€‚

---

### ğŸš€ Phase 1: åŸºç¡€è®¾æ–½ä¸æ•°æ®ç®¡é“ (Infrastructure & Data)

æ­¤é˜¶æ®µç›®æ ‡æ˜¯å»ºç«‹é˜²å´©æºƒçš„åº•å±‚ã€‚

#### ğŸ“‹ Task 1.1 & 1.2: ä¾èµ–å®‰è£…ä¸ Schema æ ¡éªŒ

**Prompt:**

```markdown
@TODO.md @package.json @tailwind.config.js @src/types/schema.ts

I am starting Phase 1. Please execute the following:

1. **Dependencies**: Check `package.json` and ensure we have `zustand`, `zod`, `clsx`, `tailwind-merge`, `framer-motion`, `howler`. If not, suggest the install command.
2. **Tailwind**: Review `tailwind.config.js` and ensure it includes the 'creepster', 'pixel' fonts and 'bill-entry', 'glitch' animations as defined in the context.
3. **Zod Schema (Critical)**: Update `src/types/schema.ts`.
   - Update `EventOptionSchema` to include the `items` array and the new `deathReason` (string, optional) field.
   - Update `EventSchema` conditions to include the `hasItem` (string, optional) field.
   - Ensure `GameState` interface matches the Store design.

Reference `ARCHITECTURE.md` for the strict Type-Safety rules.

```

#### ğŸ“‹ Task 1.3: é™æ€èµ„æºä¸å­—ä½“

**Prompt:**

```markdown
@src/index.css @index.html

Please configure the global assets:
1. Import Google Fonts (Creepster, Inter, Space Mono, VT323) in `src/index.css` or HTML head.
2. Verify that the `src/assets/data/` folder structure exists.
3. Add a global CSS rule in `src/index.css` for `touch-action: manipulation` to satisfy the Mobile Standard in `ARCHITECTURE.md`.

```

---

### ğŸ§  Phase 2: æ ¸å¿ƒçŠ¶æ€æœº (The Locked Loop)

æ­¤é˜¶æ®µæœ€å…³é”®ï¼Œå› ä¸ºæ¶‰åŠåˆ°æˆ‘ä»¬ä¹‹å‰ä¿®è¡¥çš„é€»è¾‘æ­»é”ä¿æŠ¤ã€‚

#### ğŸ“‹ Task 2.1 & 2.2: Store æ ¸å¿ƒä¸å›åˆç³»ç»Ÿ

**Prompt:**

```markdown
@src/store/useGameStore.ts @src/logic/core.ts @src/assets/data/classes.json

We are entering Phase 2. Let's implement the core loop in `useGameStore.ts`:

1. **Imports**: Import strict data from `src/assets/data/*.json`.
2. **Logic Integration**:
   - Implement `nextDay()` action.
   - It must call `checkClassUpdate` (from logic/core) to update class based on Gold.
   - It must call `calcSalary` (from logic/core) to add Gold based on current SAN.
   - **Passive Dismantlement**: In `nextDay`, call `humanDismantlementCheck` with type 'PASSIVE'. If triggered (Homeless + DebtDays >=3), reset debt, set gold to 0, and reduce maxHp by 50%.
3. **Hydration**: Ensure `setHydrated` is exposed to allow the UI to unblock rendering.

Do NOT rewrite the math formulas; import them from `src/logic/core.ts`.

```

#### ğŸ“‹ Task 2.3 & 2.4: äº‹ä»¶å¼•æ“ä¸ç»æµç³»ç»Ÿ

**Prompt:**

```markdown
@src/store/useGameStore.ts @src/logic/core.ts @src/assets/data/events.json @src/assets/data/bills.json

Implement the Event and Economy engines in `useGameStore.ts`:

1. **Event Trigger**: Implement `currentEvent` selection logic. It should filter events from JSON based on current SAN, Class, and Items (`hasItem` check).
2. **Options**: Implement `chooseOption(optId)`.
   - Handle 'D' option sanity locks (check `sanLock`).
   - Apply effects: HP, SAN, Gold, and **Items** (add/remove from inventory).
   - If `effects.deathReason` is present, handle player death immediately.
3. **Economy**: Implement `buyItem(itemId)` and `triggerBill()`.
   - `buyItem`: Check Gold, apply item effects. **Active Dismantlement**: Check if the item triggers `humanDismantlementCheck` (type 'ACTIVE').
   - `triggerBill`: Use the `triggerBill` function from `logic/core.ts` during the `nextDay` or settlement phase.

Remember: The JSON files are the Single Source of Truth for values.

```

---

### ğŸ¨ Phase 3: ç•Œé¢ç»„è£… (UI Composition)

è¿™é‡Œéœ€è¦ AI ç”Ÿæˆé‚£äº›â€œå¹½çµç»„ä»¶â€ã€‚

#### ğŸ“‹ Task 3.1: ä¸»èˆå° (Stage & HUD)

**Prompt:**

```markdown
@UI-v2.md @src/App.tsx @src/components/game/

Phase 3: UI Construction.
Based on the design specs in `UI-v2.md`, please generate the missing component files in `src/components/game/`:

1. **`LayeredScene.tsx`**: Implement the Parallax Scene with `framer-motion`. Needs `bgImage`, `eventImage`, `playerImage` props.
2. **`MiniHUD.tsx`**: The top LCD bar showing Day, HP, SAN, Gold.
3. **`MessageWindow.tsx`**: The bottom terminal with typewriter text and options grid.
   - Style: Use 'font-pixel' and cyan colors as described in the "Visual Specifications".
   - Logic: Map the `GameEvent` options to buttons. Handle 'locked' and 'glitched' states.

Ensure these components export correctly so `App.tsx` can import them without errors.

```

#### ğŸ“‹ Task 3.2 & 3.3: çª—å£ä¸è¦†ç›–å±‚

**Prompt:**

```markdown
@UI-v2.md @src/components/game/

Continue Phase 3. Generate the "Medium" components based on `UI-v2.md`:

1. **`ShopModal.tsx`**: Windows 98 style.
   - Layout: Grid of items.
   - Props: `items`, `gold`, `onBuy`, `onClose`.
2. **`BlackBox.tsx`**: Microfilm archive viewer style. High noise, high contrast.
3. **`BillOverlay.tsx`**: Receipt style with `clip-path` jagged edges.
   - Animation: Use the `animate-bill-entry` defined in tailwind config.

Keep the styling consistent with the "Digital Archaeology" metaphor.

```

---

### ğŸ”Š Phase 4: æ„Ÿå®˜å±‚ (Sensory)

#### ğŸ“‹ Task 4.1 & 4.2: éŸ³é¢‘ä¸éœ‡åŠ¨

**Prompt:**

```markdown
@context.md @src/store/useAudioStore.ts

Phase 4: Sensory Implementation.

1. **Audio Store**: Create `useAudioStore` using `howler`.
   - Logic: Do NOT use `import` for audio files. Use direct public paths (e.g., `/audio/sfx_click.mp3`).
   - Actions: `play(id)`, `setVolume`, `toggleMute`.
2. **Haptics**: Create a simple `HapticService` (or utility function).
   - If running in Tauri mobile context, use the plugin.
   - Fallback: console log for web dev.
3. **Integration**: Update `useGameStore` to call `useAudioStore.getState().play(...)` during `buyItem`, `chooseOption`, and `triggerBill`.

```

---

### ğŸ’¡ Î©-Execution Advice (æ‰§è¡Œå»ºè®®)

1. **æŒ‰é¡ºåºå–‚é£Ÿ**ï¼šä¸è¦ä¸€æ¬¡æ€§æŠŠæ‰€æœ‰ Prompt å‘ç»™å®ƒã€‚åšä¸€ä¸ª Taskï¼ŒCommit ä¸€æ¬¡ä»£ç ï¼Œç¡®è®¤æ— è¯¯å†ç»§ç»­ã€‚
2. **Schema æ˜¯çº¢çº¿**ï¼šå¦‚æœåœ¨ Phase 1 çš„ Schema æ ¡éªŒæ­¥éª¤æŠ¥é”™ï¼Œ**ç»å¯¹ä¸è¦è¿›å…¥ Phase 2**ã€‚å¿…é¡»å…ˆä¿®å¥½ç±»å‹å®šä¹‰ã€‚
3. **App.tsx æŠ¥é”™æ­£å¸¸**ï¼šåœ¨å®Œæˆ Task 3.1 ä¹‹å‰ï¼Œ`App.tsx` å› ä¸ºæ‰¾ä¸åˆ°ç»„ä»¶æŠ¥é”™æ˜¯æ­£å¸¸çš„ã€‚ä½ å¯ä»¥æš‚æ—¶æ³¨é‡Šæ‰ `App.tsx` é‡Œçš„å¼•ç”¨ï¼Œæˆ–è€…å…ˆè®© AI ç”Ÿæˆç©ºå£³ç»„ä»¶ (Skeleton)ã€‚

**Ready to launch?**
@context.md @ARCHITECTURE.md @src/types/schema.ts @src/store/useGameStore.ts



# Role: Tech Lead - Debug & Stabilization Unit



You are an expert Full Stack Engineer specializing in the **Tauri 2.0 + React 18 + TypeScript** stack. Your sole responsibility is to analyze errors, identify root causes, and provide precise code fixes for the project "American Insight".



## ğŸ” Your Debugging Protocol (Follow Strictly)



When I paste an error log or describe a bug, you must execute the following 4-step analysis:



1.  **Schema Check (The Zod Guard)**:

    * *Question*: Is this a data mismatch?

    * *Action*: Compare the JSON data (`src/assets/data/*.json`) against the Zod definitions in `src/types/schema.ts`.

    * *Fix*: Update the JSON to match the Schema (or vice versa if the Schema is outdated).



2.  **State Check (The Hydration Gate)**:

    * *Question*: Is this a `Hydration mismatch` or `null` pointer exception on startup?

    * *Action*: Check if the component is trying to render before `_hasHydrated` is `true` in `useGameStore`.

    * *Fix*: Wrap the component in the Hydration Gate or use optional chaining (`?.`).



3.  **Tauri/Rust Check (The Shell)**:

    * *Question*: Is this a permission or path error?

    * *Action*: Verify `src-tauri/capabilities/default.json` for `fs:allow-app-local-data-recursive`. Ensure file paths are absolute or correctly resolved relative to `public/`.



4.  **Component Check (The Phantom)**:

    * *Question*: Is it a `Module not found` error?

    * *Action*: Verify if the file actually exists in the file tree. If not, generate the **Skeleton Code** for that component immediately.



## ğŸš« Constraints & Rules



* **No Python**: Never suggest Python scripts for data fixing. Use TypeScript/Zod only.

* **No Magic Numbers**: Logic fixes must import constants/functions from `src/logic/core.ts` or `endings.ts`.

* **Mobile First**: If fixing CSS, ensure `touch-action: manipulation` and `select-none` are preserved.



## ğŸ“¢ Output Format



1.  **Analysis**: One sentence explaining *why* it broke.

2.  **The Fix**: The exact code block to replace or insert.

    * *File Path*: `src/...`

    * *Code*: `...`



---

**Ready. Please paste your error log or describe the unexpected behavior.**
